<div class="upload-container">
  <h2>Analyze Rice Quality</h2>

  <div class="upload-options">
    <!-- File Upload Option -->
    <div class="option-card upload-card" (click)="fileInput.click()">
      <div class="icon-wrapper">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="17 8 12 3 7 8" />
          <line x1="12" y1="3" x2="12" y2="15" />
        </svg>
      </div>
      <h3>Upload Image</h3>
      <p class="subtext">Select from your device</p>
      <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" class="file-input-hidden" />
      <button class="action-btn secondary">Choose File</button>
    </div>

    <div class="divider">
      <span>OR</span>
    </div>

    <!-- Camera Option -->
    <div class="option-card camera-card" [class.active]="showCamera" (click)="!showCamera && toggleCamera()">
      <div class="icon-wrapper">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
          <circle cx="12" cy="13" r="4" />
        </svg>
      </div>
      <h3>Take Photo</h3>
      <p class="subtext">Use your camera</p>
      <button (click)="toggleCamera(); $event.stopPropagation()" class="action-btn primary" [class.close]="showCamera">
        {{ showCamera ? 'Close Camera' : 'Open Camera' }}
      </button>
    </div>
  </div>

  <div *ngIf="cameraError" class="error-message">
    {{ cameraError }}
  </div>

  <div class="camera-container" *ngIf="showCamera">
    <video #videoElement autoplay playsinline></video>
    <canvas #canvasElement style="display: none;"></canvas>
    <div class="camera-controls">
      <button (click)="capturePhoto()" class="capture-btn">Capture Photo</button>
    </div>
  </div>

  <div *ngIf="selectedFile" class="selected-file-preview">
    <p>Selected: {{ selectedFile.name }}</p>
    <button (click)="onUpload()" [disabled]="isUploading" class="analyze-btn">
      {{ isUploading ? 'Analyzing...' : 'Analyze Image' }}
    </button>
  </div>

  <div class="info-banner">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0;">
      <circle cx="8" cy="8" r="7" stroke="#0066cc" stroke-width="2" fill="none" />
      <path d="M8 4v4M8 10h.01" stroke="#0066cc" stroke-width="2" stroke-linecap="round" />
    </svg>
    <span><strong>Tip:</strong> For best results, use images with dark or black backgrounds. The AI model is optimized
      for rice grains on dark surfaces.</span>
  </div>

  <div *ngIf="message" class="message" [class.error]="message.includes('failed')">
    {{ message }}
  </div>

  <div *ngIf="result" class="result-card">
    <h3>Results</h3>
    <img [src]="result.imageUrl" alt="Analyzed Image" class="preview-img">

    <div class="stats">
      <div class="stat-item happy">
        <span class="label">Good Grains</span>
        <span class="value">{{ result.goodGrains }}</span>
      </div>
      <div class="stat-item sad">
        <span class="label">Broken Grains</span>
        <span class="value">{{ result.brokenGrains }}</span>
      </div>
      <div class="stat-item total">
        <span class="label">Total</span>
        <span class="value">{{ result.totalGrains }}</span>
      </div>
    </div>

    <div class="score">
      Quality Score: <strong>{{ result.qualityScore }}%</strong>
    </div>
  </div>
</div>