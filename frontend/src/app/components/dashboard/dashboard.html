<div class="dashboard-container">
    <div class="header-section">
        <h2>Dashboard Overview</h2>
        <p class="subtitle">Monitor your rice quality analysis history and performance metrics.</p>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid" *ngIf="!loading">
        <div class="stat-card">
            <div class="stat-icon inspection-icon">
                <i class="fas fa-search"></i>
            </div>
            <div class="stat-content">
                <h3>Total Inspections</h3>
                <p class="stat-value">{{ totalInspections }}</p>
                <p class="stat-label">All time</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon quality-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>Avg. Quality Score</h3>
                <p class="stat-value">{{ averageQuality }}%</p>
                <div class="progress-mini">
                    <div [style.width.%]="averageQuality"
                        [class]="'progress-bar ' + (averageQuality > 70 ? 'success' : 'warning')"></div>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon broken-icon">
                <i class="fas fa-heart-broken"></i>
            </div>
            <div class="stat-content">
                <h3>Avg. Broken Grains</h3>
                <p class="stat-value">{{ averageBrokenGrains }}</p>
                <p class="stat-label">Per sample</p>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading your dashboard...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && history.length === 0" class="empty-state">
        <div class="empty-icon">ðŸ“Š</div>
        <h3>No Analysis Records Yet</h3>
        <p>Start by analyzing your first rice sample to see insights here.</p>
        <a routerLink="/" class="btn-primary">Analyze Sample</a>
    </div>

    <!-- History Table -->
    <div class="table-container" *ngIf="!loading && history.length > 0">
        <div class="table-header">
            <h3>Recent Analysis</h3>
        </div>
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date & Time</th>
                        <th>Image</th>
                        <th>Quality</th>
                        <th>Composition</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of history">
                        <td class="id-cell">#{{ item.id }}</td>
                        <td>
                            <div class="date-cell">
                                <span class="date">{{ item.createdAt | date:'mediumDate' }}</span>
                                <span class="time">{{ item.createdAt | date:'shortTime' }}</span>
                            </div>
                        </td>
                        <td>
                            <a [href]="item.imageUrl" target="_blank" class="view-image-link">
                                View Image <span class="arrow">â†’</span>
                            </a>
                        </td>
                        <td>
                            <div class="quality-cell">
                                <div class="quality-ring" [style.--p]="item.qualityScore"
                                    [class]="item.qualityScore > 70 ? 'good' : (item.qualityScore > 40 ? 'average' : 'poor')">
                                    {{ item.qualityScore }}%
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="composition-cell">
                                <div class="grain-stat good">
                                    <span class="label">Good</span>
                                    <span class="value">{{ item.goodGrains }}</span>
                                </div>
                                <div class="grain-stat broken">
                                    <span class="label">Broken</span>
                                    <span class="value">{{ item.brokenGrains }}</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span [class]="'status-badge ' + item.status.toLowerCase()">
                                {{ item.status }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>