<div class="dashboard">
    <h2>Analysis History</h2>

    <div *ngIf="loading" class="loading-state">
        <p>Loading history...</p>
    </div>

    <table *ngIf="!loading && history.length > 0">
        <thead>
            <tr>
                <th>ID</th>
                <th>Date</th>
                <th>Image</th>
                <th>Quality Score</th>
                <th>Good Grains</th>
                <th>Broken Grains</th>
                <th>Total</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of history">
                <td>#{{ item.id }}</td>
                <td>{{ item.createdAt | date:'mediumDate' }} <span style="color: #999; font-size: 0.85em;">{{
                        item.createdAt | date:'shortTime' }}</span></td>
                <td>
                    <a [href]="'http://localhost:3000/' + item.imageUrl" target="_blank" title="View Image">
                        View Image
                    </a>
                </td>
                <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="background: #eee; height: 6px; width: 60px; border-radius: 3px; overflow: hidden;">
                            <div [style.width.%]="item.qualityScore"
                                [style.background-color]="item.qualityScore > 70 ? 'var(--success-color)' : (item.qualityScore > 40 ? 'var(--warning-color)' : 'var(--danger-color)')"
                                style="height: 100%;"></div>
                        </div>
                        <strong>{{ item.qualityScore }}%</strong>
                    </div>
                </td>
                <td>{{ item.goodGrains }}</td>
                <td>{{ item.brokenGrains }}</td>
                <td>{{ item.totalGrains }}</td>
                <td>
                    <span [class]="'status ' + item.status.toLowerCase()">{{ item.status }}</span>
                </td>
            </tr>
        </tbody>
    </table>

    <div *ngIf="!loading && history.length === 0" class="empty-state">
        <p>No analysis records found. <a routerLink="/">Analyze your first sample</a>.</p>
    </div>
</div>